<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <link rel="icon" type="image/svg+xml" href="./icon.png" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>QR Scanner Pro</title>
    <meta name="description" content="Simple and fast QR code scanner and generator. Works offline.">
    <meta name="keywords" content="QR Code, Scanner, Generator, PWA, Wi-Fi, vCard">
    <meta property="og:title" content="QR Scanner Pro">
    <meta property="og:description" content="Fast QR code scanner and generator directly in your browser.">
    <meta property="og:type" content="website">
    <link rel="manifest" href="manifest.json">
    <link rel="stylesheet" href="style.css">
    <script type="text/javascript" src="https://unpkg.com/@zxing/library@latest"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
</head>

<body>

    <div id="scanner-screen" class="screen active">
        <div id="install-area"><button id="install-button" data-i18n="install_app">📲 アプリをインストール</button></div>

        <div class="header">
            <button id="lang-btn" class="header-btn" onclick="toggleLanguage()">🌐</button>
            <h2>[ QR Scanner Pro ]</h2>
            <button class="header-btn" onclick="switchScreen('settings-screen')">⚙️</button>
        </div>

        <div id="video-container">
            <video id="video" autoplay muted playsinline></video>
            <div class="torch-container">
                <button id="torch-btn" class="icon-btn" onclick="toggleTorch()">🔦</button>
            </div>
            <div id="zoom-slider-container">
                <input type="range" id="zoom-slider" min="1" max="1" step="0.1" value="1">
            </div>
        </div>

        <div class="bottom-ui">
            <p data-i18n="scan_guide">QRコードを枠内に写すか、画像を選択してください</p>
            <div class="btn-row">
                <button class="btn-blue" onclick="switchScreen('generator-screen')" data-i18n="create">作成</button>
                <button class="btn-gray" onclick="showHistory()" data-i18n="history">履歴</button>
                <button class="btn-blue" onclick="document.getElementById('file-input').click()"
                    style="grid-column: span 2;" data-i18n="read_from_image">🖼️ 画像から読み取る</button>
            </div>
            <input type="file" id="file-input" accept="image/*" style="display:none;" onchange="readImage(event)">
        </div>
    </div>

    <div id="result-screen" class="screen">
        <h2>[ <span data-i18n="result_title">Scan Result</span> ]</h2>
        <div id="special-action-area" class="special-card"></div>
        <textarea id="result-text" readonly></textarea>
        <div class="bottom-ui">
            <button id="open-url-btn" class="btn-blue" onclick="openURL()" style="display:none;" data-i18n="open_url">🔗
                URLを開く</button>
            <button class="btn-green" onclick="copyResult()" data-i18n="copy_result">結果をコピー</button>
            <button class="btn-gray" onclick="restartScanner()" data-i18n="resume">再開</button>
        </div>
    </div>

    <div id="history-screen" class="screen">
        <h2>[ <span data-i18n="history_title">Scan History</span> ]</h2>
        <div id="history-list"></div>
        <div class="bottom-ui">
            <button class="btn-red" onclick="clearAllHistory()" data-i18n="clear_history">全ての履歴を削除</button>
            <button class="btn-gray" onclick="switchScreen('scanner-screen')" data-i18n="back">戻る</button>
        </div>
    </div>

    <div id="settings-screen" class="screen">
        <h2>[ <span data-i18n="settings_title">Settings</span> ]</h2>
        <div class="settings-list">
            <div class="list-item">
                <span data-i18n="sound_setting">スキャン時の音</span>
                <label class="switch">
                    <input type="checkbox" id="set-sound" checked onchange="saveSettings()">
                    <span class="slider"></span>
                </label>
            </div>
            <div class="list-item">
                <span data-i18n="vibrate_setting">スキャン時の振動</span>
                <label class="switch">
                    <input type="checkbox" id="set-vibrate" checked onchange="saveSettings()">
                    <span class="slider"></span>
                </label>
            </div>
        </div>
        <div class="bottom-ui"><button class="btn-gray" onclick="switchScreen('scanner-screen')"
                data-i18n="back">戻る</button></div>
    </div>

    <div id="generator-screen" class="screen">
        <h2>[ <span data-i18n="generator_title">QR Generator</span> ]</h2>

        <select id="qr-type-select" onchange="updateGeneratorUI()" class="type-select">
            <option value="url" data-i18n="type_url">🌐 URL / テキスト</option>
            <option value="wifi" data-i18n="type_wifi">📶 Wi-Fi設定</option>
            <option value="vcard" data-i18n="type_vcard">👤 連絡先 (vCard)</option>
        </select>

        <div id="gen-inputs" class="gen-inputs-container">
            <div id="input-url">
                <input type="text" id="qr-input-url" value="https://" placeholder="URLを入力"
                    data-i18n-placeholder="placeholder_url">
            </div>
            <div id="input-wifi" style="display:none;">
                <input type="text" id="wifi-ssid" placeholder="ネットワーク名 (SSID)" data-i18n-placeholder="placeholder_ssid">
                <input type="text" id="wifi-pass" placeholder="パスワード" data-i18n-placeholder="placeholder_pass">
                <select id="wifi-type">
                    <option value="WPA">WPA/WPA2</option>
                    <option value="WEP">WEP</option>
                    <option value="nopass" data-i18n="no_pass">なし</option>
                </select>
            </div>
            <div id="input-vcard" style="display:none;">
                <input type="text" id="vc-name" placeholder="名前" data-i18n-placeholder="placeholder_name">
                <input type="tel" id="vc-tel" placeholder="電話番号" data-i18n-placeholder="placeholder_tel">
                <input type="email" id="vc-email" placeholder="メールアドレス" data-i18n-placeholder="placeholder_email">
            </div>
        </div>

        <button class="btn-blue" onclick="generateQR()" data-i18n="generate_btn">QRコードを生成</button>
        <div id="qrcode-output"></div>
        <button id="save-qr-btn" class="btn-green" onclick="downloadQRImage()"
            style="display:none; margin-bottom: 10px;" data-i18n="save_image">💾 画像を保存</button>
        <div style="flex-grow: 1;"></div>
        <button class="btn-gray" onclick="switchScreen('scanner-screen')" data-i18n="back">戻る</button>
    </div>

    <script src="script.js?v=2"></script>
</body>

</html>